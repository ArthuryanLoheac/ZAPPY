<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: docs/node_modules/cacheable-request Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dir_5033574101a36b22190bc77671f1b173.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">cacheable-request Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h1 align="center"><br  />
<img src="https://cacheable.org/assets/images/cacheable_symbol.svg" alt="cacheable logo" width="380" style="pointer-events: none;" class="inline"/><br  />
<br  />
</h1>
<h1><a class="anchor" id="autotoc_md3619"></a>
cacheable-request</h1>
<blockquote class="doxtable">
<p>Wrap native HTTP requests with RFC compliant cache support </p>
</blockquote>
<p><a href="https://github.com/jaredwray/cacheable/actions/workflows/tests.yaml"><img src="https://github.com/jaredwray/cacheable/actions/workflows/tests.yaml/badge.svg" alt="tests" style="pointer-events: none;" class="inline"/></a> <a href="https://codecov.io/gh/jaredwray/cacheable"><img src="https://codecov.io/gh/jaredwray/cacheable/branch/master/graph/badge.svg?token=LDLaqe4PsI" alt="codecov" style="pointer-events: none;" class="inline"/></a> <a href="https://www.npmjs.com/package/cacheable-request"><img src="https://img.shields.io/npm/dm/cacheable-request.svg" alt="npm" style="pointer-events: none;" class="inline"/></a> <a href="https://www.npmjs.com/package/cacheable-request"><img src="https://img.shields.io/npm/v/cacheable-request.svg" alt="npm" style="pointer-events: none;" class="inline"/></a></p>
<p><a href="http://httpwg.org/specs/rfc7234.html">RFC 7234</a> compliant HTTP caching for native Node.js HTTP/HTTPS requests. Caching works out of the box in memory or is easily pluggable with a wide range of storage adapters.</p>
<p><b>Note:</b> This is a low level wrapper around the core HTTP modules, it's not a high level request library.</p>
<h1><a class="anchor" id="autotoc_md3620"></a>
Table of Contents</h1>
<ul>
<li>Latest Changes</li>
<li>Features</li>
<li>Install and Usage</li>
<li>Storage Adapters</li>
<li>API</li>
<li>Using Hooks</li>
<li>Contributing</li>
<li>Ask a Question</li>
<li>License (MIT)</li>
</ul>
<h1><a class="anchor" id="autotoc_md3621"></a>
Latest Changes</h1>
<h2><a class="anchor" id="autotoc_md3622"></a>
Breaking Changes with v10.0.0</h2>
<p>This release contains breaking changes. This is the new way to use this package.</p>
<h3><a class="anchor" id="autotoc_md3623"></a>
Usage Before v10</h3>
<div class="fragment"><div class="line">import http from &#39;http&#39;;</div>
<div class="line">import CacheableRequest from &#39;cacheable-request&#39;;</div>
<div class="line"> </div>
<div class="line">// Then instead of</div>
<div class="line">const req = http.request(&#39;http://example.com&#39;, cb);</div>
<div class="line">req.end();</div>
<div class="line"> </div>
<div class="line">// You can do</div>
<div class="line">const cacheableRequest = new CacheableRequest(http.request);</div>
<div class="line">const cacheReq = cacheableRequest(&#39;http://example.com&#39;, cb);</div>
<div class="line">cacheReq.on(&#39;request&#39;, req =&gt; req.end());</div>
<div class="line">// Future requests to &#39;example.com&#39; will be returned from cache if still valid</div>
<div class="line"> </div>
<div class="line">// You pass in any other http.request API compatible method to be wrapped with cache support:</div>
<div class="line">const cacheableRequest = new CacheableRequest(https.request);</div>
<div class="line">const cacheableRequest = new CacheableRequest(electron.net);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3624"></a>
Usage After v10.1.0</h3>
<div class="fragment"><div class="line">import CacheableRequest from &#39;cacheable-request&#39;;</div>
<div class="line"> </div>
<div class="line">// Now You can do</div>
<div class="line">const cacheableRequest = new CacheableRequest(http.request).request();</div>
<div class="line">const cacheReq = cacheableRequest(&#39;http://example.com&#39;, cb);</div>
<div class="line">cacheReq.on(&#39;request&#39;, req =&gt; req.end());</div>
<div class="line">// Future requests to &#39;example.com&#39; will be returned from cache if still valid</div>
<div class="line"> </div>
<div class="line">// You pass in any other http.request API compatible method to be wrapped with cache support:</div>
<div class="line">const cacheableRequest = new CacheableRequest(https.request).request();</div>
<div class="line">const cacheableRequest = new CacheableRequest(electron.net).request();</div>
</div><!-- fragment --><p>The biggest change is that when you do a <code>new</code> CacheableRequest you now want to call <code>request</code> method will give you the instance to use.</p>
<div class="fragment"><div class="line">- const cacheableRequest = new CacheableRequest(http.request);</div>
<div class="line">+ const cacheableRequest = new CacheableRequest(http.request).request();</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3625"></a>
ESM Support in version 9 and higher.</h3>
<p>We are now using pure esm support in our package. If you need to use commonjs you can use v8 or lower. To learn more about using ESM please read this from <code>sindresorhus</code>: <a href="https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c">https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c</a></p>
<h2><a class="anchor" id="autotoc_md3626"></a>
Features</h2>
<ul>
<li>Only stores cacheable responses as defined by RFC 7234</li>
<li>Fresh cache entries are served directly from cache</li>
<li>Stale cache entries are revalidated with <code>If-None-Match</code>/<code>If-Modified-Since</code> headers</li>
<li>304 responses from revalidation requests use cached body</li>
<li>Updates <code>Age</code> header on cached responses</li>
<li>Can completely bypass cache on a per request basis</li>
<li>In memory cache by default</li>
<li>Official support for Redis, Memcache, Etcd, MongoDB, SQLite, PostgreSQL and MySQL storage adapters</li>
<li>Easily plug in your own or third-party storage adapters</li>
<li>If DB connection fails, cache is automatically bypassed (disabled by default)</li>
<li>Adds cache support to any existing HTTP code with minimal changes</li>
<li>Uses <a href="https://github.com/pornel/http-cache-semantics">http-cache-semantics</a> internally for HTTP RFC 7234 compliance</li>
</ul>
<h2><a class="anchor" id="autotoc_md3627"></a>
Install and Usage</h2>
<div class="fragment"><div class="line">npm install cacheable-request</div>
</div><!-- fragment --><div class="fragment"><div class="line">import http from &#39;http&#39;;</div>
<div class="line">import CacheableRequest from &#39;cacheable-request&#39;;</div>
<div class="line"> </div>
<div class="line">// Then instead of</div>
<div class="line">const req = http.request(&#39;http://example.com&#39;, cb);</div>
<div class="line">req.end();</div>
<div class="line"> </div>
<div class="line">// You can do</div>
<div class="line">const cacheableRequest = new CacheableRequest(http.request).createCacheableRequest();</div>
<div class="line">const cacheReq = cacheableRequest(&#39;http://example.com&#39;, cb);</div>
<div class="line">cacheReq.on(&#39;request&#39;, req =&gt; req.end());</div>
<div class="line">// Future requests to &#39;example.com&#39; will be returned from cache if still valid</div>
<div class="line"> </div>
<div class="line">// You pass in any other http.request API compatible method to be wrapped with cache support:</div>
<div class="line">const cacheableRequest = new CacheableRequest(https.request).createCacheableRequest();</div>
<div class="line">const cacheableRequest = new CacheableRequest(electron.net).createCacheableRequest();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3628"></a>
Storage Adapters</h2>
<p><code>cacheable-request</code> uses <a href="https://github.com/jaredwray/keyv">Keyv</a> to support a wide range of storage adapters.</p>
<p>For example, to use Redis as a cache backend, you just need to install the official Redis Keyv storage adapter:</p>
<div class="fragment"><div class="line">npm install @keyv/redis</div>
</div><!-- fragment --><p>And then you can pass <code>CacheableRequest</code> your connection string:</p>
<div class="fragment"><div class="line">const cacheableRequest = new CacheableRequest(http.request, &#39;redis://user:pass@localhost:6379&#39;).createCacheableRequest();</div>
</div><!-- fragment --><p><a href="https://github.com/jaredwray/keyv#official-storage-adapters">View all official Keyv storage adapters.</a></p>
<p>Keyv also supports anything that follows the Map API so it's easy to write your own storage adapter or use a third-party solution.</p>
<p>e.g The following are all valid storage adapters</p>
<div class="fragment"><div class="line">const storageAdapter = new Map();</div>
<div class="line">// or</div>
<div class="line">const storageAdapter = require(&#39;./my-storage-adapter&#39;);</div>
<div class="line">// or</div>
<div class="line">const QuickLRU = require(&#39;quick-lru&#39;);</div>
<div class="line">const storageAdapter = new QuickLRU({ maxSize: 1000 });</div>
<div class="line"> </div>
<div class="line">const cacheableRequest = new CacheableRequest(http.request, storageAdapter).createCacheableRequest();</div>
</div><!-- fragment --><p>View the <a href="https://github.com/jaredwray/keyv">Keyv docs</a> for more information on how to use storage adapters.</p>
<h2><a class="anchor" id="autotoc_md3629"></a>
API</h2>
<h3><a class="anchor" id="autotoc_md3630"></a>
new cacheableRequest(request, [storageAdapter])</h3>
<p>Returns the provided request function wrapped with cache support.</p>
<h4><a class="anchor" id="autotoc_md3631"></a>
request</h4>
<p>Type: <code>function</code></p>
<p>Request function to wrap with cache support. Should be <a href="https://nodejs.org/api/http.html#http_http_request_options_callback"><code>http.request</code></a> or a similar API compatible request function.</p>
<h4><a class="anchor" id="autotoc_md3632"></a>
storageAdapter</h4>
<p>Type: <code>Keyv storage adapter</code><br  />
 Default: <code>new Map()</code></p>
<p>A <a href="https://github.com/jaredwray/keyv">Keyv</a> storage adapter instance, or connection string if using with an official Keyv storage adapter.</p>
<h3><a class="anchor" id="autotoc_md3633"></a>
Instance</h3>
<h4><a class="anchor" id="autotoc_md3634"></a>
cacheableRequest(opts, [cb])</h4>
<p>Returns an event emitter.</p>
<h5><a class="anchor" id="autotoc_md3635"></a>
opts</h5>
<p>Type: <code>object</code>, <code>string</code></p>
<ul>
<li>Any of the default request functions options.</li>
<li>Any <a href="https://github.com/kornelski/http-cache-semantics#constructor-options"><code>http-cache-semantics</code></a> options.</li>
<li>Any of the following:</li>
</ul>
<h6><a class="anchor" id="autotoc_md3636"></a>
opts.cache</h6>
<p>Type: <code>boolean</code><br  />
 Default: <code>true</code></p>
<p>If the cache should be used. Setting this to false will completely bypass the cache for the current request.</p>
<h6><a class="anchor" id="autotoc_md3637"></a>
opts.strictTtl</h6>
<p>Type: <code>boolean</code><br  />
 Default: <code>false</code></p>
<p>If set to <code>true</code> once a cached resource has expired it is deleted and will have to be re-requested.</p>
<p>If set to <code>false</code> (default), after a cached resource's TTL expires it is kept in the cache and will be revalidated on the next request with <code>If-None-Match</code>/<code>If-Modified-Since</code> headers.</p>
<h6><a class="anchor" id="autotoc_md3638"></a>
opts.maxTtl</h6>
<p>Type: <code>number</code><br  />
 Default: <code>undefined</code></p>
<p>Limits TTL. The <code>number</code> represents milliseconds.</p>
<h6><a class="anchor" id="autotoc_md3639"></a>
opts.automaticFailover</h6>
<p>Type: <code>boolean</code><br  />
 Default: <code>false</code></p>
<p>When set to <code>true</code>, if the DB connection fails we will automatically fallback to a network request. DB errors will still be emitted to notify you of the problem even though the request callback may succeed.</p>
<h6><a class="anchor" id="autotoc_md3640"></a>
opts.forceRefresh</h6>
<p>Type: <code>boolean</code><br  />
 Default: <code>false</code></p>
<p>Forces refreshing the cache. If the response could be retrieved from the cache, it will perform a new request and override the cache instead.</p>
<h5><a class="anchor" id="autotoc_md3641"></a>
cb</h5>
<p>Type: <code>function</code></p>
<p>The callback function which will receive the response as an argument.</p>
<p>The response can be either a <a href="https://nodejs.org/api/http.html#http_class_http_incomingmessage">Node.js HTTP response stream</a> or a <a href="https://github.com/lukechilds/responselike">responselike object</a>. The response will also have a <code>fromCache</code> property set with a boolean value.</p>
<h5><a class="anchor" id="autotoc_md3642"></a>
.on('request', request)</h5>
<p><code>request</code> event to get the request object of the request.</p>
<p><b>Note:</b> This event will only fire if an HTTP request is actually made, not when a response is retrieved from cache. However, you should always handle the <code>request</code> event to end the request and handle any potential request errors.</p>
<h5><a class="anchor" id="autotoc_md3643"></a>
.on('response', response)</h5>
<p><code>response</code> event to get the response object from the HTTP request or cache.</p>
<h5><a class="anchor" id="autotoc_md3644"></a>
.on('error', error)</h5>
<p><code>error</code> event emitted in case of an error with the cache.</p>
<p>Errors emitted here will be an instance of <code>CacheableRequest.RequestError</code> or <code>CacheableRequest.CacheError</code>. You will only ever receive a <code>RequestError</code> if the request function throws (normally caused by invalid user input). Normal request errors should be handled inside the <code>request</code> event.</p>
<p>To properly handle all error scenarios you should use the following pattern:</p>
<div class="fragment"><div class="line">cacheableRequest(&#39;example.com&#39;, cb)</div>
<div class="line">  .on(&#39;error&#39;, err =&gt; {</div>
<div class="line">    if (err instanceof CacheableRequest.CacheError) {</div>
<div class="line">      handleCacheError(err); // Cache error</div>
<div class="line">    } else if (err instanceof CacheableRequest.RequestError) {</div>
<div class="line">      handleRequestError(err); // Request function thrown</div>
<div class="line">    }</div>
<div class="line">  })</div>
<div class="line">  .on(&#39;request&#39;, req =&gt; {</div>
<div class="line">    req.on(&#39;error&#39;, handleRequestError); // Request error emitted</div>
<div class="line">    req.end();</div>
<div class="line">  });</div>
</div><!-- fragment --><p> <b>Note:</b> Database connection errors are emitted here, however <code>cacheable-request</code> will attempt to re-request the resource and bypass the cache on a connection error. Therefore a database connection error doesn't necessarily mean the request won't be fulfilled.</p>
<h2><a class="anchor" id="autotoc_md3645"></a>
Using Hooks</h2>
<p>Hooks have been implemented since version <code>v9</code> and are very useful to modify response before saving it in cache. You can use hooks to modify response before saving it in cache.</p>
<h3><a class="anchor" id="autotoc_md3646"></a>
Add Hooks</h3>
<p>The hook will pre compute response right before saving it in cache. You can include many hooks and it will run in order you add hook on response object.</p>
<div class="fragment"><div class="line">import http from &#39;http&#39;;</div>
<div class="line">import CacheableRequest from &#39;cacheable-request&#39;;</div>
<div class="line"> </div>
<div class="line">const cacheableRequest = new CacheableRequest(request, cache).request();</div>
<div class="line"> </div>
<div class="line">// adding a hook to decompress response</div>
<div class="line">cacheableRequest.addHook(&#39;onResponse&#39;, async (value: CacheValue, response: any) =&gt; {</div>
<div class="line">  const buffer = await pm(gunzip)(value.body);</div>
<div class="line">  value.body = buffer.toString();</div>
<div class="line">  return value;</div>
<div class="line">});</div>
</div><!-- fragment --><p>here is also an example of how to add in the remote address</p>
<div class="fragment"><div class="line">import CacheableRequest, {CacheValue} from &#39;cacheable-request&#39;;</div>
<div class="line"> </div>
<div class="line">const cacheableRequest = new CacheableRequest(request, cache).request();</div>
<div class="line">cacheableRequest.addHook(&#39;onResponse&#39;, (value: CacheValue, response: any) =&gt; {</div>
<div class="line">  if (response.connection) {</div>
<div class="line">    value.remoteAddress = response.connection.remoteAddress;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  return value;</div>
<div class="line">});</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3647"></a>
Remove Hooks</h3>
<p>You can also remove hook by using below</p>
<div class="fragment"><div class="line">CacheableRequest.removeHook(&#39;onResponse&#39;);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3648"></a>
How to Contribute</h2>
<p>Cacheable-Request is an open source package and community driven that is maintained regularly. In addtion we have a couple of other guidelines for review:</p>
<ul>
<li>CODE_OF_CONDUCT.md - Our code of conduct</li>
<li>CONTRIBUTING.md - How to contribute to this project</li>
<li>SECURITY.md - Security guidelines and supported versions</li>
</ul>
<h2><a class="anchor" id="autotoc_md3649"></a>
Post an Issue</h2>
<p>To post an issue, navigate to the "Issues" tab in the main repository, and then select "New Issue." Enter a clear title describing the issue, as well as a description containing additional relevant information. Also select the label that best describes your issue type. For a bug report, for example, create an issue with the label "bug." In the description field, Be sure to include replication steps, as well as any relevant error messages.</p>
<p>If you're reporting a security violation, be sure to check out the project's security policy.</p>
<p>Please also refer to our Code of Conduct for more information on how to report issues.</p>
<h2><a class="anchor" id="autotoc_md3650"></a>
Ask a Question</h2>
<p>To ask a question, create an issue with the label "question." In the issue description, include the related code and any context that can help us answer your question.</p>
<h2><a class="anchor" id="autotoc_md3651"></a>
License</h2>
<p>This project is under the [MIT](LICENSE) license.</p>
<p>MIT © Luke Childs 2017-2021 and Jared Wray 2022+ </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_49e56c817e5e54854c35e136979f97ca.html">docs</a></li><li class="navelem"><a class="el" href="dir_a0409b32ef7fd26e7246cf83548265be.html">node_modules</a></li><li class="navelem"><a class="el" href="dir_5033574101a36b22190bc77671f1b173.html">cacheable-request</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>

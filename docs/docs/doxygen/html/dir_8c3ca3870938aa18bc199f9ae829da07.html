<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: docs/node_modules/http2-wrapper Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dir_8c3ca3870938aa18bc199f9ae829da07.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">http2-wrapper Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<blockquote class="doxtable">
<p>HTTP/2 client, just with the familiar <code>https</code> API </p>
</blockquote>
<p><a href="https://github.com/szmarczak/http2-wrapper/actions"><img src="https://github.com/szmarczak/http2-wrapper/workflows/Node%20CI/badge.svg" alt="Node CI" style="pointer-events: none;" class="inline"/></a> <a href="https://codecov.io/gh/szmarczak/http2-wrapper"><img src="https://codecov.io/gh/szmarczak/http2-wrapper/branch/master/graph/badge.svg" alt="codecov" style="pointer-events: none;" class="inline"/></a> <a href="https://www.npmjs.com/package/http2-wrapper"><img src="https://img.shields.io/npm/dm/http2-wrapper.svg" alt="npm" style="pointer-events: none;" class="inline"/></a> <a href="https://packagephobia.now.sh/result?p=http2-wrapper"><img src="https://packagephobia.now.sh/badge?p=http2-wrapper" alt="install size" class="inline"/></a></p>
<p>This package was created to support HTTP/2 without the need to rewrite your code.<br  />
 I recommend adapting to the <a href="https://nodejs.org/api/http2.html"><code>http2</code></a> module if possible - it's much simpler to use and has many cool features!</p>
<p><b>Tip</b>: <code>http2-wrapper</code> is very useful when you rely on other modules that use the HTTP/1 API and you want to support HTTP/2.</p>
<p><b>Pro Tip</b>: While the native <code>http2</code> doesn't have agents yet, you can use <code>http2-wrapper</code> Agents and still operate on the native HTTP/2 streams.</p>
<h1><a class="anchor" id="autotoc_md9765"></a>
Installation</h1>
<blockquote class="doxtable">
<p><code>$ npm install http2-wrapper</code><br  />
 <code>$ yarn add http2-wrapper</code> </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md9766"></a>
Usage</h1>
<div class="fragment"><div class="line">const http2 = require(&#39;http2-wrapper&#39;);</div>
<div class="line"> </div>
<div class="line">const options = {</div>
<div class="line">    hostname: &#39;nghttp2.org&#39;,</div>
<div class="line">    protocol: &#39;https:&#39;,</div>
<div class="line">    path: &#39;/httpbin/post&#39;,</div>
<div class="line">    method: &#39;POST&#39;,</div>
<div class="line">    headers: {</div>
<div class="line">        &#39;content-length&#39;: 6</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">const request = http2.request(options, response =&gt; {</div>
<div class="line">    console.log(&#39;statusCode:&#39;, response.statusCode);</div>
<div class="line">    console.log(&#39;headers:&#39;, response.headers);</div>
<div class="line"> </div>
<div class="line">    const body = [];</div>
<div class="line">    response.on(&#39;data&#39;, chunk =&gt; {</div>
<div class="line">        body.push(chunk);</div>
<div class="line">    });</div>
<div class="line">    response.on(&#39;end&#39;, () =&gt; {</div>
<div class="line">        console.log(&#39;body:&#39;, Buffer.concat(body).toString());</div>
<div class="line">    });</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">request.on(&#39;error&#39;, console.error);</div>
<div class="line"> </div>
<div class="line">request.write(&#39;123&#39;);</div>
<div class="line">request.end(&#39;456&#39;);</div>
<div class="line"> </div>
<div class="line">// statusCode: 200</div>
<div class="line">// headers: [Object: null prototype] {</div>
<div class="line">//   &#39;:status&#39;: 200,</div>
<div class="line">//   date: &#39;Fri, 27 Sep 2019 19:45:46 GMT&#39;,</div>
<div class="line">//   &#39;content-type&#39;: &#39;application/json&#39;,</div>
<div class="line">//   &#39;access-control-allow-origin&#39;: &#39;*&#39;,</div>
<div class="line">//   &#39;access-control-allow-credentials&#39;: &#39;true&#39;,</div>
<div class="line">//   &#39;content-length&#39;: &#39;239&#39;,</div>
<div class="line">//   &#39;x-backend-header-rtt&#39;: &#39;0.002516&#39;,</div>
<div class="line">//   &#39;strict-transport-security&#39;: &#39;max-age=31536000&#39;,</div>
<div class="line">//   server: &#39;nghttpx&#39;,</div>
<div class="line">//   via: &#39;1.1 nghttpx&#39;,</div>
<div class="line">//   &#39;alt-svc&#39;: &#39;h3-23=&quot;:4433&quot;; ma=3600&#39;,</div>
<div class="line">//   &#39;x-frame-options&#39;: &#39;SAMEORIGIN&#39;,</div>
<div class="line">//   &#39;x-xss-protection&#39;: &#39;1; mode=block&#39;,</div>
<div class="line">//   &#39;x-content-type-options&#39;: &#39;nosniff&#39;</div>
<div class="line">// }</div>
<div class="line">// body: {</div>
<div class="line">//   &quot;args&quot;: {},</div>
<div class="line">//   &quot;data&quot;: &quot;123456&quot;,</div>
<div class="line">//   &quot;files&quot;: {},</div>
<div class="line">//   &quot;form&quot;: {},</div>
<div class="line">//   &quot;headers&quot;: {</div>
<div class="line">//     &quot;Content-Length&quot;: &quot;6&quot;,</div>
<div class="line">//     &quot;Host&quot;: &quot;nghttp2.org&quot;</div>
<div class="line">//   },</div>
<div class="line">//   &quot;json&quot;: 123456,</div>
<div class="line">//   &quot;origin&quot;: &quot;xxx.xxx.xxx.xxx&quot;,</div>
<div class="line">//   &quot;url&quot;: &quot;https://nghttp2.org/httpbin/post&quot;</div>
<div class="line">// }</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md9767"></a>
API</h1>
<p><b>Note:</b> The <code>session</code> option was renamed to <code>tlsSession</code> for better readability.</p>
<p><b>Note:</b> The <code>timeout</code> option applies to HTTP/2 streams only. In order to set session timeout, pass an Agent with custom <code>timeout</code> option set.</p>
<h2><a class="anchor" id="autotoc_md9768"></a>
http2.auto(url, options, callback)</h2>
<p>Performs <a href="https://nodejs.org/api/tls.html#tls_alpn_and_sni">ALPN</a> negotiation. Returns a Promise giving proper <code>ClientRequest</code> instance (depending on the ALPN).</p>
<p><b>Note</b>: The <code>agent</code> option represents an object with <code>http</code>, <code>https</code> and <code>http2</code> properties.</p>
<div class="fragment"><div class="line">const http2 = require(&#39;http2-wrapper&#39;);</div>
<div class="line"> </div>
<div class="line">const options = {</div>
<div class="line">    hostname: &#39;httpbin.org&#39;,</div>
<div class="line">    protocol: &#39;http:&#39;, // Try changing this to https:</div>
<div class="line">    path: &#39;/post&#39;,</div>
<div class="line">    method: &#39;POST&#39;,</div>
<div class="line">    headers: {</div>
<div class="line">        &#39;content-length&#39;: 6</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">(async () =&gt; {</div>
<div class="line">    try {</div>
<div class="line">        const request = await http2.auto(options, response =&gt; {</div>
<div class="line">            console.log(&#39;statusCode:&#39;, response.statusCode);</div>
<div class="line">            console.log(&#39;headers:&#39;, response.headers);</div>
<div class="line"> </div>
<div class="line">            const body = [];</div>
<div class="line">            response.on(&#39;data&#39;, chunk =&gt; body.push(chunk));</div>
<div class="line">            response.on(&#39;end&#39;, () =&gt; {</div>
<div class="line">                console.log(&#39;body:&#39;, Buffer.concat(body).toString());</div>
<div class="line">            });</div>
<div class="line">        });</div>
<div class="line"> </div>
<div class="line">        request.on(&#39;error&#39;, console.error);</div>
<div class="line"> </div>
<div class="line">        request.write(&#39;123&#39;);</div>
<div class="line">        request.end(&#39;456&#39;);</div>
<div class="line">    } catch (error) {</div>
<div class="line">        console.error(error);</div>
<div class="line">    }</div>
<div class="line">})();</div>
<div class="line"> </div>
<div class="line">// statusCode: 200</div>
<div class="line">// headers: { connection: &#39;close&#39;,</div>
<div class="line">//   server: &#39;gunicorn/19.9.0&#39;,</div>
<div class="line">//   date: &#39;Sat, 15 Dec 2018 18:19:32 GMT&#39;,</div>
<div class="line">//   &#39;content-type&#39;: &#39;application/json&#39;,</div>
<div class="line">//   &#39;content-length&#39;: &#39;259&#39;,</div>
<div class="line">//   &#39;access-control-allow-origin&#39;: &#39;*&#39;,</div>
<div class="line">//   &#39;access-control-allow-credentials&#39;: &#39;true&#39;,</div>
<div class="line">//   via: &#39;1.1 vegur&#39; }</div>
<div class="line">// body: {</div>
<div class="line">//   &quot;args&quot;: {},</div>
<div class="line">//   &quot;data&quot;: &quot;123456&quot;,</div>
<div class="line">//   &quot;files&quot;: {},</div>
<div class="line">//   &quot;form&quot;: {},</div>
<div class="line">//   &quot;headers&quot;: {</div>
<div class="line">//     &quot;Connection&quot;: &quot;close&quot;,</div>
<div class="line">//     &quot;Content-Length&quot;: &quot;6&quot;,</div>
<div class="line">//     &quot;Host&quot;: &quot;httpbin.org&quot;</div>
<div class="line">//   },</div>
<div class="line">//   &quot;json&quot;: 123456,</div>
<div class="line">//   &quot;origin&quot;: &quot;xxx.xxx.xxx.xxx&quot;,</div>
<div class="line">//   &quot;url&quot;: &quot;http://httpbin.org/post&quot;</div>
<div class="line">// }</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md9769"></a>
http2.auto.protocolCache</h2>
<p>An instance of <a href="https://github.com/sindresorhus/quick-lru"><code>quick-lru</code></a> used for ALPN cache.</p>
<p>There is a maximum of 100 entries. You can modify the limit through <code>protocolCache.maxSize</code> - note that the change will be visible globally.</p>
<h2><a class="anchor" id="autotoc_md9770"></a>
http2.auto.createResolveProtocol(cache, queue, connect)</h2>
<h3><a class="anchor" id="autotoc_md9771"></a>
cache</h3>
<p>Type: <code>Map&lt;string, string&gt;</code></p>
<p>This is the store where cached ALPN protocols are put into.</p>
<h3><a class="anchor" id="autotoc_md9772"></a>
queue</h3>
<p>Type: <code>Map&lt;string, Promise&gt;</code></p>
<p>This is the store that contains pending ALPN negotiation promises.</p>
<h3><a class="anchor" id="autotoc_md9773"></a>
connect</h3>
<p>Type: <code>(options, callback) =&gt; TLSSocket | Promise&lt;TLSSocket&gt;</code></p>
<p>See <a href="https://github.com/szmarczak/resolve-alpn#connect">https://github.com/szmarczak/resolve-alpn#connect</a></p>
<h2><a class="anchor" id="autotoc_md9774"></a>
http2.auto.resolveProtocol(options)</h2>
<p>Returns a <code>Promise&lt;{alpnProtocol: string}&gt;</code>.</p>
<h2><a class="anchor" id="autotoc_md9775"></a>
http2.request(url, options, callback)</h2>
<p>Same as <a href="https://nodejs.org/api/https.html#https_https_request_options_callback"><code>https.request</code></a>.</p>
<h4><a class="anchor" id="autotoc_md9776"></a>
options.h2session</h4>
<p>Type: <code>Http2Session</code><br  />
</p>
<p>The session used to make the actual request. If none provided, it will use <code>options.agent</code> to get one.</p>
<h2><a class="anchor" id="autotoc_md9777"></a>
http2.get(url, options, callback)</h2>
<p>Same as <a href="https://nodejs.org/api/https.html#https_https_get_options_callback"><code>https.get</code></a>.</p>
<h2><a class="anchor" id="autotoc_md9778"></a>
new http2.ClientRequest(url, options, callback)</h2>
<p>Same as <a href="https://nodejs.org/api/https.html#https_class_https_clientrequest"><code>https.ClientRequest</code></a>.</p>
<h2><a class="anchor" id="autotoc_md9779"></a>
new http2.IncomingMessage(socket)</h2>
<p>Same as <a href="https://nodejs.org/api/https.html#https_class_https_incomingmessage"><code>https.IncomingMessage</code></a>.</p>
<h2><a class="anchor" id="autotoc_md9780"></a>
new http2.Agent(options)</h2>
<p><b>Note:</b> this is <b>not</b> compatible with the classic <code>http.Agent</code>.</p>
<p>Usage example:</p>
<div class="fragment"><div class="line">const http2 = require(&#39;http2-wrapper&#39;);</div>
<div class="line"> </div>
<div class="line">class MyAgent extends http2.Agent {</div>
<div class="line">    createConnection(origin, options) {</div>
<div class="line">        console.log(`Connecting to ${http2.Agent.normalizeOrigin(origin)}`);</div>
<div class="line">        return http2.Agent.connect(origin, options);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">http2.get({</div>
<div class="line">    hostname: &#39;google.com&#39;,</div>
<div class="line">    agent: new MyAgent()</div>
<div class="line">}, response =&gt; {</div>
<div class="line">    response.on(&#39;data&#39;, chunk =&gt; console.log(`Received chunk of ${chunk.length} bytes`));</div>
<div class="line">});</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md9781"></a>
options</h3>
<p>Each option is an <code>Agent</code> property and can be changed later.</p>
<h4><a class="anchor" id="autotoc_md9782"></a>
timeout</h4>
<p>Type: <code>number</code><br  />
 Default: <code>0</code></p>
<p>If there's no activity after <code>timeout</code> milliseconds, the session will be closed. If <code>0</code>, no timeout is applied.</p>
<h4><a class="anchor" id="autotoc_md9783"></a>
maxSessions</h4>
<p>Type: <code>number</code><br  />
 Default: <code>Infinity</code></p>
<p>The maximum amount of sessions in total.</p>
<h4><a class="anchor" id="autotoc_md9784"></a>
maxEmptySessions</h4>
<p>Type: <code>number</code><br  />
 Default: <code>10</code></p>
<p>The maximum amount of empty sessions in total. An empty session is a session with no pending requests.</p>
<h4><a class="anchor" id="autotoc_md9785"></a>
maxCachedTlsSessions</h4>
<p>Type: <code>number</code><br  />
 Default: <code>100</code></p>
<p>The maximum amount of cached TLS sessions.</p>
<h3><a class="anchor" id="autotoc_md9786"></a>
agent.protocol</h3>
<p>Type: <code>string</code><br  />
 Default: <code>https:</code></p>
<h3><a class="anchor" id="autotoc_md9787"></a>
agent.settings</h3>
<p>Type: <code>object</code><br  />
 Default: <code>{enablePush: false}</code></p>
<p><a href="https://nodejs.org/api/http2.html#http2_settings_object">Settings</a> used by the current agent instance.</p>
<h3><a class="anchor" id="autotoc_md9788"></a>
agent.normalizeOptions(<a href="https://github.com/szmarczak/http2-wrapper/blob/master/source/agent.js">options</a>)</h3>
<p>Returns a string representing normalized options.</p>
<div class="fragment"><div class="line">Agent.normalizeOptions({servername: &#39;example.com&#39;});</div>
<div class="line">// =&gt; &#39;:::::::::::::::::::::::::::::::::::::&#39;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md9789"></a>
agent.getSession(origin, options)</h3>
<h4><a class="anchor" id="autotoc_md9790"></a>
<a href="https://nodejs.org/api/http2.html#http2_http2_connect_authority_options_listener">origin</a></h4>
<p>Type: <code>string</code> <code>URL</code> <code>object</code></p>
<p>Origin used to create new session.</p>
<h4><a class="anchor" id="autotoc_md9791"></a>
<a href="https://nodejs.org/api/http2.html#http2_http2_connect_authority_options_listener">options</a></h4>
<p>Type: <code>object</code></p>
<p>Options used to create new session.</p>
<p>Returns a Promise giving free <code>Http2Session</code>. If no free sessions are found, a new one is created.</p>
<p>A session is considered free when pending streams count is less than max concurrent streams settings.</p>
<h3><a class="anchor" id="autotoc_md9792"></a>
agent.getSession(origin, [options](options-1), listener)</h3>
<h4><a class="anchor" id="autotoc_md9793"></a>
listener</h4>
<p>Type: <code>object</code></p>
<div class="fragment"><div class="line">{</div>
<div class="line">    reject: error =&gt; void,</div>
<div class="line">    resolve: session =&gt; void</div>
<div class="line">}</div>
</div><!-- fragment --><p>If the <code>listener</code> argument is present, the Promise will resolve immediately. It will use the <code>resolve</code> function to pass the session.</p>
<h3><a class="anchor" id="autotoc_md9794"></a>
agent.request(origin, options, <a href="https://nodejs.org/api/http2.html#http2_headers_object">headers</a>, <a href="https://nodejs.org/api/http2.html#http2_clienthttp2session_request_headers_options">streamOptions</a>)</h3>
<p>Returns a Promise giving <code>Http2Stream</code>.</p>
<h3><a class="anchor" id="autotoc_md9795"></a>
agent.createConnection(origin, options)</h3>
<p>Returns a new <code>TLSSocket</code>. It defaults to <code>Agent.connect(origin, options)</code>.</p>
<h3><a class="anchor" id="autotoc_md9796"></a>
agent.closeEmptySessions(count)</h3>
<h4><a class="anchor" id="autotoc_md9797"></a>
count</h4>
<p>Type: <code>number</code> Default: <code>Number.POSITIVE_INFINITY</code></p>
<p>Makes an attempt to close empty sessions. Only sessions with 0 concurrent streams will be closed.</p>
<h3><a class="anchor" id="autotoc_md9798"></a>
agent.destroy(reason)</h3>
<p>Destroys <b>all</b> sessions.</p>
<h3><a class="anchor" id="autotoc_md9799"></a>
agent.emptySessionCount</h3>
<p>Type: <code>number</code></p>
<p>A number of empty sessions.</p>
<h3><a class="anchor" id="autotoc_md9800"></a>
agent.pendingSessionCount</h3>
<p>Type: <code>number</code></p>
<p>A number of pending sessions.</p>
<h3><a class="anchor" id="autotoc_md9801"></a>
agent.sessionCount</h3>
<p>Type: <code>number</code></p>
<p>A number of all sessions held by the Agent.</p>
<h3><a class="anchor" id="autotoc_md9802"></a>
Event: 'session'</h3>
<div class="fragment"><div class="line">agent.on(&#39;session&#39;, session =&gt; {</div>
<div class="line">    // A new session has been created by the Agent.</div>
<div class="line">});</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md9803"></a>
Proxy support</h1>
<p>Currently <code>http2-wrapper</code> provides support for these proxies:</p>
<ul>
<li><code>HttpOverHttp2</code></li>
<li><code>HttpsOverHttp2</code></li>
<li><code>Http2OverHttp2</code></li>
<li><code>Http2OverHttp</code></li>
<li><code>Http2OverHttps</code></li>
</ul>
<p>Any of the above can be accessed via <code>http2wrapper.proxies</code>. Check out the <a href="examples/proxies"><code>examples/proxies</code></a> directory to learn more.</p>
<p><b>Note:</b> If you use the <code>http2.auto</code> function, the real IP address will leak. <code>http2wrapper</code> is not aware of the context. It will create a connection to the end server using your real IP address to get the ALPN protocol. Then it will create another connection using proxy. To migitate this, you need to pass a custom <code>resolveProtocol</code> function as an option:</p>
<div class="fragment"><div class="line">const resolveAlpnProxy = new URL(&#39;https://username:password@localhost:8000&#39;);</div>
<div class="line">const connect = async (options, callback) =&gt; new Promise((resolve, reject) =&gt; {</div>
<div class="line">    const host = `${options.host}:${options.port}`;</div>
<div class="line"> </div>
<div class="line">    (async () =&gt; {</div>
<div class="line">        try {</div>
<div class="line">            const request = await http2.auto(resolveAlpnProxy, {</div>
<div class="line">                method: &#39;CONNECT&#39;,</div>
<div class="line">                headers: {</div>
<div class="line">                    host</div>
<div class="line">                },</div>
<div class="line">                path: host,</div>
<div class="line"> </div>
<div class="line">                // For demo purposes only!</div>
<div class="line">                rejectUnauthorized: false,</div>
<div class="line">            });</div>
<div class="line"> </div>
<div class="line">            request.end();</div>
<div class="line"> </div>
<div class="line">            request.once(&#39;error&#39;, reject);</div>
<div class="line"> </div>
<div class="line">            request.once(&#39;connect&#39;, (response, socket, head) =&gt; {</div>
<div class="line">                if (head.length &gt; 0) {</div>
<div class="line">                    reject(new Error(`Unexpected data before CONNECT tunnel: ${head.length} bytes`));</div>
<div class="line"> </div>
<div class="line">                    socket.destroy();</div>
<div class="line">                    return;</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                const tlsSocket = tls.connect({</div>
<div class="line">                    ...options,</div>
<div class="line">                    socket</div>
<div class="line">                }, callback);</div>
<div class="line"> </div>
<div class="line">                resolve(tlsSocket);</div>
<div class="line">            });</div>
<div class="line">        } catch (error) {</div>
<div class="line">            reject(error);</div>
<div class="line">        }</div>
<div class="line">    })();</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">// This is required to prevent leaking real IP address on ALPN negotiation</div>
<div class="line">const resolveProtocol = http2.auto.createResolveProtocol(new Map(), new Map(), connect);</div>
<div class="line"> </div>
<div class="line">const request = await http2.auto(&#39;https://httpbin.org/anything&#39;, {</div>
<div class="line">    agent: {…},</div>
<div class="line">    resolveProtocol</div>
<div class="line">}, response =&gt; {</div>
<div class="line">    // Read the response here</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">request.end();</div>
</div><!-- fragment --><p>See <a href="examples/proxies/unknown-over-unknown.js"><code>unknown-over-unknown.js</code></a> to learn more.</p>
<h1><a class="anchor" id="autotoc_md9804"></a>
Mirroring another server</h1>
<p>See <a href="examples/proxies/mirror.js"><code>examples/proxies/mirror.js</code></a> for an example.</p>
<h1><a class="anchor" id="autotoc_md9805"></a>
<a href="https://tools.ietf.org/html/rfc8441">WebSockets over HTTP/2</a></h1>
<p>See <a href="examples/ws"><code>examples/ws</code></a> for an example.</p>
<h1><a class="anchor" id="autotoc_md9806"></a>
Push streams</h1>
<p>See <a href="examples/push-stream"><code>examples/push-stream</code></a> for an example.</p>
<h1><a class="anchor" id="autotoc_md9807"></a>
Related</h1>
<ul>
<li><a href="https://github.com/sindresorhus/got"><code>got</code></a> - Simplified HTTP requests</li>
<li><a href="https://github.com/nxtedition/node-http2-proxy"><code>http2-proxy</code></a> - A simple http/2 &amp; http/1.1 spec compliant proxy helper for Node.</li>
</ul>
<h1><a class="anchor" id="autotoc_md9808"></a>
License</h1>
<p>MIT </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_49e56c817e5e54854c35e136979f97ca.html">docs</a></li><li class="navelem"><a class="el" href="dir_a0409b32ef7fd26e7246cf83548265be.html">node_modules</a></li><li class="navelem"><a class="el" href="dir_8c3ca3870938aa18bc199f9ae829da07.html">http2-wrapper</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
